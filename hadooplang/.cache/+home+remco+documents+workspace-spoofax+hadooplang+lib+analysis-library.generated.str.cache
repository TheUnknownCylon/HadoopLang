Module("lib/analysis-library.generated",[Imports([Import("libstratego-lib"),Import("libstratego-parallel"),Import("lib/editor-common.generated"),Import("lib/analysis-library-internal.generated"),Import("lib/index-library.generated")]),Signature([Constructors([OpDecl("Editor",ConstType(SortNoArgs("AnalysisPhase"))),OpDecl("Compile",ConstType(SortNoArgs("AnalysisPhase"))),OpDecl("Def",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")]))],ConstType(SortNoArgs("Summary")))),OpDecl("Use",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")]))],ConstType(SortNoArgs("Summary")))),OpDecl("BadUse",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")]))],ConstType(SortNoArgs("Summary")))),OpDecl("Read",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")]))],ConstType(SortNoArgs("Summary")))),OpDecl("ReadWildcard",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")])),ConstType(SortNoArgs("String"))],ConstType(SortNoArgs("Summary")))),OpDecl("Diff",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")])),ConstType(Sort("List",[SortNoArgs("Summary")]))],ConstType(SortNoArgs("Summary")))),OpDecl("StopLookup",ConstType(SortNoArgs("LookupAction")))])]),Rules([SDefT("adjust-index-lookup",[DefaultVarDec("check-target-name")],[DefaultVarDec("namespace"),DefaultVarDec("path"),DefaultVarDec("prefix")],Fail),SDefT("adjust-index-def-data",[DefaultVarDec("store-results")],[DefaultVarDec("namespace"),DefaultVarDec("path")],Fail),SDefT("adjust-index-path",[DefaultVarDec("check-target-definition")],[DefaultVarDec("namespace"),DefaultVarDec("path")],Fail),SDefNoArgs("index-diff-constructors",Match(NoAnnoList(Op("Def",[Wld])))),RDefNoArgs("index-diff-compare",Rule(NoAnnoList(Tuple([NoAnnoList(Op("Def",[Var("u1")])),NoAnnoList(Op("Def",[Var("u2")]))])),RootApp(Id),BA(CallNoArgs(SVar("index-uri-eq")),NoAnnoList(Tuple([Var("u1"),Var("u2")])))))]),Rules([RDefT("analyze-top",[],[DefaultVarDec("language")],RuleNoCond(NoAnnoList(Tuple([Var("ast"),Var("path"),Var("project-path")])),App(CallT(SVar("analyze-top"),[],[NoAnnoList(Op("Editor",[])),Var("language"),Var("path"),Var("project-path")]),Var("ast")))),RDefT("analyze-top",[],[DefaultVarDec("phase"),DefaultVarDec("language"),DefaultVarDec("path"),DefaultVarDec("project-path")],Rule(Var("ast"),NoAnnoList(Tuple([Var("ast'"),Var("filesToAnalyze")])),[WithClause(Seq(Assign(Var("full-path"),NoAnnoList(StringQuotation1("                     ",[StringEscape1("                     ",Var("project-path")),QStr("/"),StringEscape1("                                    ",Var("path"))]))),CondChoice(CallNoArgs(SVar("index-split")),Seq(CallT(SVar("index-setup"),[],[Var("language"),NoAnnoList(List([Var("project-path")])),Var("full-path")]),Seq(Assign(Var("asts"),App(CallNoArgs(SVar("index-toplevel-split")),Var("ast"))),Seq(Assign(Var("astsFilePairs"),App(Call(SVar("map"),[CallT(SVar("ast-uri-to-ast-file"),[],[Var("full-path")])]),Var("asts"))),Assign(NoAnnoList(Op("Results",[Var("ast'"),Wld,Wld,Wld,Wld,Wld,Var("filesToAnalyze")])),App(CallT(SVar("analyze-top-internal"),[],[Var("phase"),Var("language"),Var("project-path"),Var("full-path")]),Var("astsFilePairs")))))),Seq(Assign(NoAnnoList(Op("Results",[Var("asts"),Wld,Wld,Wld,Wld,Wld,Var("filesToAnalyze")])),App(CallT(SVar("analyze-top-internal"),[],[Var("phase"),Var("language"),Var("project-path"),Var("full-path")]),NoAnnoList(List([NoAnnoList(Tuple([Var("ast"),Var("full-path")]))])))),Assign(Var("ast'"),App(CallNoArgs(SVar("Hd")),Var("asts")))))))]))]),Rules([RDef("index-parallel-analyze-files",[DefaultVarDec("analyze")],Rule(Var("files"),NoAnnoList(Op("None",[])),[WithClause(Seq(CallNoArgs(SVar("length")),CallNoArgs(SVar("set-total-work-units")))),WithClause(Seq(Call(SVar("index-parallel-analyze"),[CallNoArgs(SVar("analyze"))]),Call(SVar("filter"),[Seq(Not(LChoice(Match(NoAnnoList(Op("ParallelResults",[NoAnnoList(Tuple([])),NoAnnoList(Tuple([])),Wld,Wld,Wld,Wld]))),Match(NoAnnoList(Op("ParallelResults",[NoAnnoList(Tuple([])),NoAnnoList(List([NoAnnoList(Tuple([]))])),Wld,Wld,Wld,Wld]))))),CallNoArgs(SVar("index-set-markers")))])))]))]),Rules([RDefT("index-get-data",[],[DefaultVarDec("kind")],RuleNoCond(RootApp(CallT(SVar("with"),[Match(NoAnnoList(Op("Def",[Var("uri")])))],[NoAnnoList(Str("\"Def expected\""))])),App(CallNoArgs(SVar("index-get-value")),NoAnnoList(Op("DefData",[Var("uri"),Var("kind"),NoAnnoList(Tuple([]))]))))),RDefT("index-get-data-all",[],[DefaultVarDec("kind")],RuleNoCond(RootApp(CallT(SVar("with"),[Match(NoAnnoList(Op("Def",[Var("uri")])))],[NoAnnoList(Str("\"Def expected\""))])),App(CallNoArgs(SVar("index-get-all-values")),NoAnnoList(Op("DefData",[Var("uri"),Var("kind"),NoAnnoList(Tuple([]))]))))),RDefNoArgs("index-get-uses-all",RuleNoCond(RootApp(CallT(SVar("with"),[Match(NoAnnoList(Op("Def",[Var("uri")])))],[NoAnnoList(Str("\"Def expected\""))])),App(CallNoArgs(SVar("index-get-all")),NoAnnoList(Op("Use",[Var("uri")]))))),RDefNoArgs("index-get-reads-all",Rule(Var("template"),App(CallNoArgs(SVar("conc")),NoAnnoList(Tuple([Var("reads"),Var("readwildcards'")]))),Seq(Assign(Var("uri"),App(CallNoArgs(SVar("index-uri")),Var("template"))),Seq(Assign(Var("reads"),App(CallNoArgs(SVar("index-get-all")),NoAnnoList(Op("Read",[Var("uri")])))),CondChoice(AM(Build(Var("uri")),NoAnnoList(ListTail([Var("namespace"),Var("prefix")],Var("path-parent")))),Seq(Assign(Var("readwildcards"),App(CallNoArgs(SVar("index-get-all")),NoAnnoList(Op("ReadWildcard",[NoAnnoList(ListTail([Var("namespace")],Var("path-parent"))),NoAnnoList(Tuple([]))])))),Assign(Var("readwildcards'"),App(Call(SVar("filter"),[CallT(SVar("index-readwildcard-substring"),[],[Var("prefix")])]),Var("readwildcards")))),Assign(Var("readwildcards'"),NoAnnoList(List([])))))))),RDefNoArgs("index-get-all",Rule(Var("template"),App(CallNoArgs(SVar("indexlib-get-all")),Var("template")),[WithClause(IfThen(Assign(Var("set"),RootApp(CallNoArgs(SVar("Index-ReadSet")))),Seq(Assign(Var("uri"),RootApp(CallNoArgs(SVar("index-uri")))),BA(CallT(SVar("iset-add"),[],[NoAnnoList(Op("Read",[Var("uri")]))]),Var("set")))))])),RDefNoArgs("index-get-all-values",RuleNoCond(Var("template"),App(Call(SVar("map"),[CallNoArgs(SVar("index-value"))]),App(CallNoArgs(SVar("index-get-all")),Var("template"))))),RDefNoArgs("index-get",RuleNoCond(Var("template"),App(Match(NoAnnoList(ListTail([RootApp(Id)],Wld))),App(CallNoArgs(SVar("index-get-all")),Var("template"))))),RDefNoArgs("index-get-value",RuleNoCond(Var("template"),App(CallNoArgs(SVar("index-value")),App(Match(NoAnnoList(ListTail([RootApp(Id)],Wld))),App(CallNoArgs(SVar("index-get-all")),Var("template")))))),SDefT("index-get-children",[],[DefaultVarDec("namespace")],CallT(SVar("index-get-children"),[LRule(RuleNoCond(Var("uri"),NoAnnoList(Op("Def",[Var("uri")]))))],[Var("namespace")])),RDefT("index-get-children",[DefaultVarDec("construct-template")],[DefaultVarDec("namespace")],Rule(RootApp(CallT(SVar("with"),[LChoice(Match(NoAnnoList(Op("Def",[NoAnnoList(ListTail([Var("parent-ns")],Var("path")))]))),LChoice(Match(AnnoList(Wld,[NoAnnoList(ListTail([Var("parent-ns")],Var("path")))])),Match(NoAnnoList(ListTail([Var("parent-ns")],Var("path"))))))],[NoAnnoList(Str("\"Def, key or uri expected\""))])),Var("children"),[WithClause(Seq(Assign(Var("template"),App(CallNoArgs(SVar("construct-template")),NoAnnoList(ListTail([Var("namespace")],Var("path"))))),Seq(Assign(Var("children"),RootApp(Prim("\"LANG_index_get_children\"",[Var("template")]))),BA(CallT(SVar("store-wildcard-read"),[],[Var("namespace"),Var("path"),NoAnnoList(Str("\"\""))]),Var("children")))))])),SDefT("index-get-children",[],[DefaultVarDec("namespace"),DefaultVarDec("prefix")],CallT(SVar("index-get-children"),[LRule(RuleNoCond(Var("uri"),NoAnnoList(Op("Def",[Var("uri")]))))],[Var("namespace"),Var("prefix")])),RDefT("index-get-children",[DefaultVarDec("construct-template")],[DefaultVarDec("namespace"),DefaultVarDec("prefix")],Rule(RootApp(CallT(SVar("with"),[LChoice(Match(NoAnnoList(Op("Def",[NoAnnoList(ListTail([Var("parent-ns")],Var("path")))]))),LChoice(Match(AnnoList(Wld,[NoAnnoList(ListTail([Var("parent-ns")],Var("path")))])),Match(NoAnnoList(ListTail([Var("parent-ns")],Var("path"))))))],[NoAnnoList(Str("\"Def, key or uri expected\""))])),Var("children'"),[WithClause(Seq(Assign(Var("prefix'"),App(CallNoArgs(SVar("strip-annos")),Var("prefix"))),Seq(Assign(Var("template"),App(CallNoArgs(SVar("construct-template")),NoAnnoList(ListTail([Var("namespace")],Var("path"))))),Seq(Assign(Var("children"),RootApp(Prim("\"LANG_index_get_children\"",[Var("template")]))),Seq(Assign(Var("children'"),App(Call(SVar("filter"),[CallT(SVar("index-is-name-substring"),[],[Var("prefix'")])]),Var("children"))),BA(CallT(SVar("store-wildcard-read"),[],[Var("namespace"),Var("path"),Var("prefix'")]),Var("children'")))))))])),RDef("index-get-referenced-files",[DefaultVarDec("construct-from-uri")],Rule(Var("entries"),Var("files"),Seq(Assign(Var("uris"),App(Call(SVar("filter"),[CallNoArgs(SVar("index-uri"))]),Var("entries"))),Seq(Assign(Var("referenced"),App(CallNoArgs(SVar("concat")),App(Call(SVar("filter"),[CallNoArgs(SVar("construct-from-uri"))]),Var("uris")))),Assign(Var("files"),App(CallNoArgs(SVar("iset-elements")),App(CallT(SVar("iset-addlist"),[],[App(Call(SVar("mapconcat"),[CallNoArgs(SVar("index-get-files-of"))]),Var("referenced"))]),RootApp(CallNoArgs(SVar("new-iset")))))))))),SDefNoArgs("index-get-dependent-files",Call(SVar("index-get-referenced-files"),[CallNoArgs(SVar("index-file-dependent-construct"))]))]),Rules([RDefNoArgs("index-lookup",RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),RootApp(CallT(SVar("index-lookup"),[Id],[App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")),Var("path"),App(CallNoArgs(SVar("strip-annos")),Var("x"))])))),RDefNoArgs("index-lookup-all",RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),RootApp(CallT(SVar("index-lookup-all"),[Id],[App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")),Var("path"),App(CallNoArgs(SVar("strip-annos")),Var("x"))])))),RDefT("index-lookup-outermost",[],[DefaultVarDec("prefix")],RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),RootApp(CallT(SVar("index-lookup-outermost"),[Id],[App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")),Var("path"),Var("prefix")])))),RDefT("index-lookup-one-level",[],[DefaultVarDec("prefix")],RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),RootApp(CallT(SVar("index-lookup-one-level"),[Id],[App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")),Var("path"),Var("prefix")])))),RDefT("index-lookup-all-levels",[],[DefaultVarDec("prefix")],RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),RootApp(CallT(SVar("index-lookup-all-levels"),[Id],[App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")),Var("path"),Var("prefix")])))),RDefT("index-lookup-children",[],[DefaultVarDec("namespace"),DefaultVarDec("prefix")],Rule(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("ns")],Var("path")))]),Var("defs"),[WithClause(LChoice(CondChoice(AM(Build(Var("ns")),NoAnnoList(Op("Unresolved",[Wld]))),Seq(Assign(NoAnnoList(Op("Def",[NoAnnoList(ListTail([Wld],Var("def-path")))])),RootApp(CallNoArgs(SVar("index-lookup")))),Assign(Var("defs"),App(CallT(SVar("index-lookup-one-level"),[Id],[Var("namespace"),Var("def-path"),Var("prefix")]),Var("x")))),Assign(Var("defs"),RootApp(CallT(SVar("index-lookup-one-level"),[Id],[App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")),Var("path"),Var("prefix")])))),Assign(Var("defs"),NoAnnoList(List([])))))]))]),Rules([RDefNoArgs("index-uri-namespace",RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),App(CallNoArgs(SVar("index-namespace-unwrap")),Var("namespace")))),RDefNoArgs("index-uri-path",Rule(AnnoList(Var("x"),[NoAnnoList(ListTail([Var("namespace")],Var("path")))]),Var("path'"),CondChoice(AM(Build(Var("namespace")),NoAnnoList(Op("Unresolved",[Var("namespace")]))),Assign(NoAnnoList(Op("Def",[Var("path'")])),RootApp(CallNoArgs(SVar("index-lookup")))),Assign(Var("path'"),Var("path"))))),RDefNoArgs("index-uri-name",RuleNoCond(AnnoList(Var("x"),[NoAnnoList(ListTail([Wld],NoAnnoList(ListTail([Var("name")],Wld))))]),Var("name"))),RDefNoArgs("index-uri-name",Rule(Var("x"),App(CallNoArgs(SVar("index-uri-name")),App(CallNoArgs(SVar("index-uri")),Var("x"))),Not(BA(CallNoArgs(SVar("has-annos")),Var("x"))))),SDefNoArgs("index-is-definition",Where(CallNoArgs(SVar("nam-get-definition-key")))),RDefNoArgs("index-key-eq",Rule(NoAnnoList(Tuple([Var("k1"),Var("k2")])),RootApp(Id),BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([App(CallNoArgs(SVar("index-key-unwrap")),Var("k1")),App(CallNoArgs(SVar("index-key-unwrap")),Var("k2"))])))))])])