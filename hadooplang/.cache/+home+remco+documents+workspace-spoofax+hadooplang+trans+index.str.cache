Module("trans/index",[Imports([Import("include/Hadooplang"),Import("libstratego-lib"),Import("include/Hadooplang"),Import("lib/editor-common.generated"),Import("lib/analysis-auto.generated"),Import("lib/index-library.generated"),Import("lib/analysis-library.generated"),Import("lib/analysis-library-internal.generated")]),Signature([Constructors([OpDecl("StoredNode",FunType([ConstType(SortNoArgs("URI")),ConstType(SortNoArgs("Data"))],ConstType(SortNoArgs("NodeData")))),OpDecl("StoredDataUpdate",FunType([ConstType(SortNoArgs("URI")),ConstType(SortNoArgs("Data"))],ConstType(SortNoArgs("StoredDataUpdate")))),OpDecl("CachedError",FunType([ConstType(SortNoArgs("URI")),ConstType(SortNoArgs("Data"))],ConstType(SortNoArgs("DDef")))),OpDecl("StoreDatasetHDP",FunType([ConstType(SortNoArgs("URI"))],ConstType(SortNoArgs("StoreDatasetHDP"))))])]),Rules([RDefT("adjust-index-def-data",[DefaultVarDec("store-results")],[DefaultVarDec("namespace"),DefaultVarDec("path")],RuleNoCond(Var("e"),App(CallNoArgs(SVar("store-results")),NoAnnoList(Op("StoredNode",[NoAnnoList(ListTail([Var("namespace")],Var("path"))),Var("e")]))))),RDefNoArgs("put-node",Rule(Var("x"),NoAnnoList(Op("None",[])),Seq(Assign(Var("file"),RootApp(CallNoArgs(SVar("index-get-current-file")))),BA(CallT(SVar("index-add"),[],[Var("file")]),Var("x")))))]),Rules([RDefNoArgs("get-node",Rule(Var("x"),App(CallNoArgs(SVar("index-get-value")),NoAnnoList(Op("StoredNode",[Var("uri"),NoAnnoList(Tuple([]))]))),Assign(NoAnnoList(Op("Def",[Var("uri")])),App(CallNoArgs(SVar("index-lookup")),Var("x"))))),RDefNoArgs("get-all-nodes",Rule(Var("x"),App(CallNoArgs(SVar("index-get-all-values")),NoAnnoList(Op("StoredNode",[Var("uri"),NoAnnoList(Tuple([]))]))),Assign(NoAnnoList(Op("Def",[Var("uri")])),App(CallNoArgs(SVar("index-lookup")),Var("x"))))),RDefNoArgs("get-dataupdate",Rule(Var("x"),App(CallNoArgs(SVar("index-get-value")),NoAnnoList(Op("StoredDataUpdate",[Var("uri"),NoAnnoList(Tuple([]))]))),Assign(NoAnnoList(Op("Def",[Var("uri")])),App(CallNoArgs(SVar("index-lookup")),Var("x"))))),RDefNoArgs("get-all-dataupdates",Rule(Var("x"),App(CallNoArgs(SVar("index-get-all-values")),NoAnnoList(Op("StoredDataUpdate",[Var("uri"),NoAnnoList(Tuple([]))]))),Assign(NoAnnoList(Op("Def",[Var("uri")])),App(CallNoArgs(SVar("index-lookup")),Var("x"))))),RDefNoArgs("get-uses",Rule(Var("x"),App(CallNoArgs(SVar("index-get-all")),NoAnnoList(Op("Use",[Var("uri")]))),Assign(NoAnnoList(Op("Def",[Var("uri")])),App(CallNoArgs(SVar("index-lookup")),Var("x")))))]),Rules([RDefNoArgs("extra-index-hook",RuleNoCond(As(Var("r"),NoAnnoList(Op("DatasetSetVar",[NoAnnoList(Op("DatasetRef",[AnnoList(Var("varname"),[NoAnnoList(ListTail([Var("ns")],Var("path")))])])),Var("expr")]))),App(CallNoArgs(SVar("put-node")),NoAnnoList(Op("StoredDataUpdate",[NoAnnoList(ListTail([Var("ns")],Var("path"))),Var("r")]))))),RDefNoArgs("extra-index-hook",RuleNoCond(NoAnnoList(Op("Store",[AnnoList(Var("name"),[NoAnnoList(ListTail([Var("ns")],Var("path")))])])),App(CallNoArgs(SVar("put-node")),NoAnnoList(Op("StoreDatasetHDP",[NoAnnoList(ListTail([Var("ns")],Var("path")))])))))]),Rules([RDefT("adjust-index-lookup",[DefaultVarDec("target")],[DefaultVarDec("namespace"),DefaultVarDec("path"),DefaultVarDec("prefix")],Rule(NoAnnoList(Op("RewriteRef",[RootApp(CallNoArgs(SVar("target")))])),App(CallNoArgs(SVar("concat")),NoAnnoList(List([NoAnnoList(List([])),NoAnnoList(List([NoAnnoList(ListTail([NoAnnoList(Op("Rewriter",[]))],Var("path")))])),Var("importPaths")]))),[WithClause(Assign(Var("importPaths"),App(Call(SVar("filter"),[CallNoArgs(SVar("import-rewriter-to-path"))]),App(CallT(SVar("index-get-all-in-file"),[],[NoAnnoList(Op("Import",[]))]),RootApp(CallNoArgs(SVar("index-get-current-file")))))))])),RDefNoArgs("import-rewriter-to-path",RuleNoCond(NoAnnoList(Op("Def",[NoAnnoList(ListTail([NoAnnoList(Op("Import",[])),NoAnnoList(Op("OneImportRewriter",[Var("mod"),NoAnnoList(Op("RewriteRef",[Var("name")]))]))],Wld))])),NoAnnoList(Op("Def",[NoAnnoList(List([NoAnnoList(Op("Rewriter",[])),Var("name"),Var("mod")]))]))))]),Rules([RDefT("adjust-index-lookup",[DefaultVarDec("target")],[DefaultVarDec("namespace"),DefaultVarDec("path"),DefaultVarDec("prefix")],Rule(NoAnnoList(Op("MapperRef",[RootApp(CallNoArgs(SVar("target")))])),App(CallNoArgs(SVar("concat")),NoAnnoList(List([NoAnnoList(List([])),NoAnnoList(List([NoAnnoList(ListTail([NoAnnoList(Op("Mapper",[]))],Var("path")))])),Var("importPaths")]))),[WithClause(Assign(Var("importPaths"),App(Call(SVar("filter"),[CallNoArgs(SVar("import-mapper-to-path"))]),App(CallT(SVar("index-get-all-in-file"),[],[NoAnnoList(Op("Import",[]))]),RootApp(CallNoArgs(SVar("index-get-current-file")))))))])),RDefNoArgs("import-mapper-to-path",RuleNoCond(NoAnnoList(Op("Def",[NoAnnoList(ListTail([NoAnnoList(Op("Import",[])),NoAnnoList(Op("OneImportMapper",[Var("mod"),NoAnnoList(Op("MapperRef",[Var("name")]))]))],Wld))])),NoAnnoList(Op("Def",[NoAnnoList(List([NoAnnoList(Op("Mapper",[])),Var("name"),Var("mod")]))]))))]),Rules([RDefT("adjust-index-lookup",[DefaultVarDec("target")],[DefaultVarDec("namespace"),DefaultVarDec("path"),DefaultVarDec("prefix")],Rule(NoAnnoList(Op("ReducerRef",[RootApp(CallNoArgs(SVar("target")))])),App(CallNoArgs(SVar("concat")),NoAnnoList(List([NoAnnoList(List([])),NoAnnoList(List([NoAnnoList(ListTail([NoAnnoList(Op("Reducer",[]))],Var("path")))])),Var("importPaths")]))),[WithClause(Assign(Var("importPaths"),App(Call(SVar("filter"),[CallNoArgs(SVar("import-reducer-to-path"))]),App(CallT(SVar("index-get-all-in-file"),[],[NoAnnoList(Op("Import",[]))]),RootApp(CallNoArgs(SVar("index-get-current-file")))))))])),RDefNoArgs("import-reducer-to-path",RuleNoCond(NoAnnoList(Op("Def",[NoAnnoList(ListTail([NoAnnoList(Op("Import",[])),NoAnnoList(Op("OneImportReducer",[Var("mod"),NoAnnoList(Op("ReducerRef",[Var("name")]))]))],Wld))])),NoAnnoList(Op("Def",[NoAnnoList(List([NoAnnoList(Op("Reducer",[])),Var("name"),Var("mod")]))]))))])])